---
title: Qt on Macæ‘¸ç´¢è®°å½• - å…¶äºŒ
abbrlink: 54018
date: 2019-09-19 01:11:03
tags:
  - æ•™ç¨‹
  - Qt
  - C++
categories:
  - æ•™ç¨‹
footnote: true
---

è·Ÿç€[ä¸Šä¸€ç¯‡](./posts/46595/)ç»§ç»­ã€‚æœ¬ç¯‡ä»‹ç»Qté‡æ–°é€ çš„è½®å­ï¼šå®¹å™¨ç³»ç»Ÿå’Œæ–‡ä»¶æ“ä½œç³»ç»Ÿã€‚

<!--more-->

## å®¹å™¨

æŒ‰ç†è¯´æ ‡å‡†åº“é‡Œé¢å°±æœ‰å„ç§å®¹å™¨çš„å®ç°äº†ï¼Œè¿™é‡Œé‡æ–°é€ è½®å­äº†ï¼Ÿ

å®¹å™¨åˆ†ä¸ºäº†ä¸¤ç±»ï¼šåºåˆ—å®¹å™¨ å’Œ å…³è”å®¹å™¨ã€‚

### QVector

åŠ¨æ€æ•°ç»„å®¹å™¨ï¼Œå†…éƒ¨æœ¬è´¨å°±æ˜¯å†…å­˜è¿ç»­çš„æ•°ç»„ï¼Œä»è€Œä½¿å¾—éšæœºå­˜å–çš„æ•ˆç‡éå¸¸é«˜ã€‚ä½†æ˜¯å¯¹äºå…ƒç´ çš„åˆ é™¤æ’å…¥æ“ä½œæ€§èƒ½ä¼šæ¯”è¾ƒå·®ã€‚å¯¹äºé•¿åº¦å¾ˆå¤§çš„åºåˆ—ï¼Œæ¨èé‡‡ç”¨é“¾è¡¨å®ç°çš„çš„`QList`ã€‚

`QVector`çš„ä¾‹å­å¦‚ä¸‹ã€‚ä½¿ç”¨éå¸¸ç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚

```cpp
#include <QVector>
#include <QTextStream>

int main(void) {

    QTextStream out(stdout);

    QVector<int> vals = {1, 2, 3, 4, 5};

    out << "The size of the vector is: " << vals.size() << endl;

    out << "The first item is: " << vals.first() << endl;
    out << "The last item is: " << vals.last() << endl;

    vals.append(6);
    vals.prepend(0);

    out << "Elements: ";

    for (int val : vals) {
        out << val << " ";
    }

    out << endl;

    return 0;
}
```

### `QList`

`QList` ä¹Ÿæ˜¯åºåˆ—å®¹å™¨ï¼Œå†…éƒ¨æ˜¯é“¾è¡¨å®ç°ã€‚å…¶éšæœºè®¿é—®ã€åˆ é™¤ã€æ’å…¥æ“ä½œæ•ˆç‡éƒ½æ¯”è¾ƒé«˜ã€‚å› æ­¤æ˜¯ Qt ä¸­æœ€å¸¸ç”¨çš„å®¹å™¨ã€‚å‚è€ƒä¸‹é¢ğŸ‘‡è¿™ä¸ªä¾‹å­ã€‚

```cpp
#include <QTextStream>
#include <QList>
#include <algorithm>

int main(void) {

    QTextStream out(stdout);

    QList<QString> authors = {"Balzac", "Tolstoy", 
        "Gulbranssen", "London"};
  
    for (int i=0; i < authors.size(); ++i) {
  
        out << authors.at(i) << endl;
    }  
  
    authors << "Galsworthy" << "Sienkiewicz";

    out << "***********************" << endl;

    std::sort(authors.begin(), authors.end());

    out << "Sorted:" << endl;
    for (QString author : authors) {
  
        out << author << endl;
    }  
}
```

### `QStringList`

ä¸ºå­—ç¬¦ä¸²åšäº†ä¼˜åŒ–çš„åˆ—è¡¨ã€‚

```cpp
#include <QTextStream>
#include <QList>

int main(void) {

    QTextStream out(stdout);

    QString string = "coin, book, cup, pencil, clock, bookmark";
    QStringList items = string.split(",");
    QStringListIterator it(items);

    while (it.hasNext()) {
        out << it.next().trimmed() << endl;
    }
}
```

### `QSet`

é›†åˆå¯ä»¥ç¡®ä¿å…¶ä¸­å­˜å‚¨çš„å€¼æ˜¯å”¯ä¸€çš„ã€‚

```cpp
#include <QSet>
#include <QList>
#include <QTextStream>
#include <algorithm>

int main(void) {

    QTextStream out(stdout);

    QSet<QString> cols1 = {"yellow", "red", "blue"};
    QSet<QString> cols2 = {"blue", "pink", "orange"};

    out << "There are " << cols1.size() << " values in the set" << endl;

    cols1.insert("brown");

    out << "There are " << cols1.size() << " values in the set" << endl;

    cols1.unite(cols2);

    out << "There are " << cols1.size() << " values in the set" << endl;

    for (QString val : cols1) {
        out << val << endl;
    }

    QList<QString> lcols = cols1.values();
    std::sort(lcols.begin(), lcols.end());

    out << "*********************" << endl;
    out << "Sorted:" << endl;

    for (QString val : lcols) {
        out << val << endl;
    }

   return 0;
}
```

å¯ä»¥çœ‹åˆ°åˆå¹¶(`unite()`)åé‡å¤å…ƒç´ è¢«ç§»é™¤äº†ï¼Œåªç•™ä¸‹ä¸€ä»½ã€‚

### `QMap`

`QMap`æ˜¯å…³è”å¼å®¹å™¨ï¼Œå­˜å‚¨key-valueå¯¹ã€‚ä¸‹é¢æ˜¯`QMap`ä½¿ç”¨çš„ä¾‹å­ï¼š

```cpp
#include <QTextStream>
#include <QMap>

int main(void) {

    QTextStream out(stdout);

    QMap<QString, int> items = { {"coins", 5}, {"books", 3} };

    items.insert("bottles", 7);

    QList<int> values = items.values();

    out << "Values:" << endl;

    for (int val : values) {
        out << val << endl;
    }

    QList<QString> keys = items.keys();

    out << "Keys:" << endl;
    for (QString key : keys) {
        out << key << endl;
    }

    QMapIterator<QString, int> it(items);

    out << "Pairs:" << endl;

    while (it.hasNext()) {
        it.next();
        out << it.key() << ": " << it.value() << endl;
    }
}
```

### è‡ªå®šä¹‰æ’åº

è‡ªå®šä¹‰æ’åºå…¶å®å°±æ˜¯è¦è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ã€‚ä»¥ä¸‹é¢çš„ç±»ä¸ºä¾‹ï¼š

```cpp
// book.h
class Book {

    public:
        Book(QString, QString);
        QString getAuthor() const;
        QString getTitle() const;

    private:
        QString author;
        QString title;
};
```

```cpp
// book.cpp
#include <QString>
#include "book.h"

Book::Book(QString auth, QString tit) {
    author = auth;
    title = tit;
}

QString Book::getAuthor() const {
    return author;
}

QString Book::getTitle() const {
    return title;
}
```

ä½¿ç”¨è‡ªå®šä¹‰çš„æ–¹å¼æ’åºå¦‚ä¸‹ï¼š

```cpp
#include <QTextStream>
#include <QList>
#include <algorithm> 
#include "book.h"

bool compareByTitle(const Book &b1, const Book &b2) {
    
  return b1.getTitle() < b2.getTitle();
}

int main(void) {

    QTextStream out(stdout);

    QList<Book> books = {
        Book("Jack London", "The Call of the Wild"),
        Book("HonorÃ© de Balzac", "Father Goriot"),
        Book("Leo Tolstoy", "War and Peace"),
        Book("Gustave Flaubert", "Sentimental education"),
        Book("Guy de Maupassant", "Une vie"),
        Book("William Shakespeare", "Hamlet")
    };

    std::sort(books.begin(), books.end(), compareByTitle);

    for (Book book : books) {
        out << book.getAuthor() << ": " << book.getTitle() << endl;
    }
}
```

## æ–‡ä»¶ç³»ç»Ÿ

è¿™é‡Œæ¶‰åŠ`QFile`, `QDir`, `QFileInfo`ä¸‰ä¸ªç±»ã€‚å…¶ä¸­`QFile`è´Ÿè´£æ“ä½œæ–‡ä»¶ï¼ˆè¯»å–å’Œå†™å…¥ï¼‰ï¼Œ`QDir`æä¾›äº†è®¿é—®è·¯å¾„ç»“æ„åŠå…¶å†…å®¹çš„æ¥å£ï¼Œ`QFileInfo`æä¾›äº†ä¸ç‹¬ç«‹äºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶å­˜å‚¨çš„è·¯å¾„ï¼Œè®¿é—®æ—¶é—´ï¼Œä¿®æ”¹æ—¶é—´ï¼Œæƒé™ï¼Œæ–‡ä»¶æ‰€æœ‰æƒä¿¡æ¯ã€‚

### æ–‡ä»¶å¤§å°

æ–‡ä»¶çš„å¤§å°é€šè¿‡`QFileInfo::size()`å‡½æ•°æ¥è·å–ã€‚è§ä¸‹é¢çš„å®Œæ•´ä¾‹å­:

```cpp
#include <QTextStream>
#include <QFileInfo>

int main(int argc, char *argv[]) {

  QTextStream out(stdout);

  if (argc != 2) {
    qWarning("Usage: file_size file");
    return 1;
  }
  
  QString filename = argv[1];
  
  if (!QFile(filename).exists()) {
    qWarning("The file does not exist");
    return 1;
  }  
  
  QFileInfo fileinfo(filename);
  
  qint64 size = fileinfo.size();
  
  QString str = "The size is: %1 bytes";
  
  out << str.arg(size) << endl;
}
```

### è¯»å–æ–‡ä»¶å†…å®¹

è¯»å–æ–‡ä»¶ä¹‹å‰éœ€è¦æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶åŸºäºè¿™ä¸ªæ–‡ä»¶åˆ›å»ºæµã€‚

```cpp
#include <QTextStream>
#include <QFile>

int main(void) {
  QTextStream out(stdout);

  QFile file("colours");
  
  if (!file.open(QIODevice::ReadOnly)) {
    qWarning("Cannot open file for reading");
    return 1;
  }

  QTextStream in(&file);

  while (!in.atEnd()) {
    QString line = in.readLine();
    out << line << endl;
  }

  file.close();
}
```

### å†™å…¥æ–‡ä»¶å†…å®¹

è¦å†™å…¥æ–‡ä»¶éœ€è¦æ–‡ä»¶ä»¥å†™å…¥æ¨¡å¼æ‰“å¼€ã€‚

```cpp
#include <QTextStream>
#include <QFile>

int main(void) {
    
  QTextStream out(stdout);
    
  QString filename = "distros";
  QFile file(filename);
  
  if (file.open(QIODevice::WriteOnly)) {
      
    QTextStream out(&file);
    out << "Xubuntu" << endl;
    out << "Arch" << endl;
    out << "Debian" << endl;
    out << "Redhat" << endl;
    out << "Slackware" << endl;
    
  } else {
      
    qWarning("Could not open file");
  }  
  
  file.close(); 
}
```

### å¤åˆ¶æ–‡ä»¶

```cpp
#include <QTextStream>
#include <QFile>

int main(int argc, char *argv[]) {
  QTextStream out(stdout);
  
  if (argc != 3) {
      qWarning("Usage: copyfile source destination");
      return 1;
  }
  
  QString source = argv[1];
  
  if (!QFile(source).exists()) {
      qWarning("The source file does not exist");
      return 1;
  }
  
  QString destin(argv[2]);

  QFile::copy(source, destin);
}
```

### æ–‡ä»¶ä¿¡æ¯çš„è·å–

- æ–‡ä»¶æ‰€æœ‰è€…ï¼š`QFileInfo::group()`å’Œ`QFileInfo::owner()`ï¼Œè¿”å›çš„éƒ½æ˜¯`QString`;
- ä¿®æ”¹æ—¶é—´: `QFileInfo::lastRead()`å’Œ`QFileInfo::lastModified()`ï¼Œè¿”å›çš„æ˜¯`QDateTime`;
- æ–‡ä»¶è·¯å¾„ï¼šå‚è§ä¸‹é¢çš„ä¾‹å­

```cpp
// filepath.cpp
#include <QTextStream>
#include <QFileInfo>

int main(int argc, char *argv[]) {
  QTextStream out(stdout);

  if (argc != 2) {
      out << "Usage: file_times file" << endl;
      return 1;
  }
  
  QString filename = argv[1];
  
  QFileInfo fileinfo(filename);
  
  QString absPath = fileinfo.absoluteFilePath();
  QString baseName = fileinfo.baseName();
  QString compBaseName = fileinfo.completeBaseName();
  QString fileName = fileinfo.fileName();
  QString suffix = fileinfo.suffix();
  QString compSuffix = fileinfo.completeSuffix();
  
  out << "Absolute file path: " << absPath << endl;
  out << "Base name: " << baseName << endl;
  out << "Complete base name: " << compBaseName << endl;
  out << "File name: " << fileName << endl;
  out << "Suffix: " << suffix << endl;
  out << "Whole suffix: " << compSuffix << endl;
}
```

è¾“å‡ºä¸º

```text
$ ./file_path ~/Downloads/qt-everywhere-opensource-src-5.5.1.tar.gz 
Absolute file path: /home/janbodnar/Downloads/qt-everywhere-opensource-src-5.5.1.tar.gz
Base name: qt-everywhere-opensource-src-5
Complete base name: qt-everywhere-opensource-src-5.5.1.tar
File name: qt-everywhere-opensource-src-5.5.1.tar.gz
Suffix: gz
Whole suffix: 5.1.tar.gz
```

- æƒé™ä¿¡æ¯ï¼šé€šè¿‡`QFile::permissions`æ–¹æ³•å¯ä»¥æƒé™ä¿¡æ¯ï¼Œå…·ä½“çš„ä¾‹å­å¦‚ä¸‹ï¼š

```cpp
#include <QTextStream>
#include <QFile>

int main(int argc, char *argv[]) {
  QTextStream out(stdout);

  if (argc != 2) {
      out << "Usage: permissions file" << endl;
      return 1;
  }
  
  QString filename = argv[1];
  
  QFile::Permissions ps = QFile::permissions(filename);
  
  QString fper;
  
  if (ps & QFile::ReadOwner) {
      fper.append('r');
  } else {
      fper.append('-');
  }
  
  if (ps & QFile::WriteOwner) {
      fper.append('w');
  } else {
      fper.append('-');
  }  
  
  if (ps & QFile::ExeOwner) {
      fper.append('x');
  } else {
      fper.append('-');
  }
  
  if (ps & QFile::ReadGroup) {
      fper.append('r');
  } else {
      fper.append('-');
  }
  
  if (ps & QFile::WriteGroup) {
      fper.append('w');
  } else {
      fper.append('-');
  }  
  
  if (ps & QFile::ExeGroup) {
      fper.append('x');
  } else {
      fper.append('-');
  }
  
  if (ps & QFile::ReadOther) {
      fper.append('r');
  } else {
      fper.append('-');
  }
  
  if (ps & QFile::WriteOther) {
      fper.append('w');
  } else {
      fper.append('-');
  }  
  
  if (ps & QFile::ExeOther) {
      fper.append('x');
  } else {
      fper.append('-');
  }
  
  out << fper << endl;
}
```

### æ“ä½œè·¯å¾„(directories)

- åˆ›å»ºæ–‡ä»¶å¤¹: `QDir::mkdir()`ï¼Œè¿”å›å¸ƒå°”å€¼è¡¨æ˜åˆ›å»ºæ˜¯å¦æˆåŠŸã€‚`QDir::mkpath()`ä¹Ÿæ˜¯åˆ›å»ºæ–‡ä»¶å¤¹ ï¼Œå…¶åŒºåˆ«åœ¨äº`mkpath()`å‡½æ•°ä¼šåŒæ—¶åˆ›å»ºç¼ºå°‘çš„çˆ¶æ–‡ä»¶å¤¹ã€‚
- é‡å‘½å:  `QDir::exists()`, æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚
- è·å–  ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š
    - `QDir::currentPath()`
    - `QDir::homePath()`
    - `QDir::tempPath()`
    - `QDir::rootPath()`
- è¾“å‡ºæ–‡ä»¶å¤¹å†…çš„å†…å®¹

```cpp
#include <QTextStream>
#include <QFileInfo>
#include <QDir>

int main(int argc, char *argv[]) {
  QTextStream out(stdout);

  if (argc != 2) {
      qWarning("Usage: list_dir directory");
      return 1;
  }
  
  QString directory = argv[1];
  
  QDir dir(directory);
  
  if (!dir.exists()) {
      qWarning("The directory does not exist");
      return 1;
  }  
  
  dir.setFilter(QDir::Files | QDir::AllDirs);
  dir.setSorting(QDir::Size | QDir::Reversed);

  QFileInfoList list = dir.entryInfoList();
  
  int max_size = 0;
  
  foreach (QFileInfo finfo, list) {
      QString name = finfo.fileName();
      int size = name.size();
      if (size > max_size) {
          max_size = size;
      }
  }
  
  int len = max_size + 2;
  
  out << QString("Filename").leftJustified(len).append("Bytes") << endl;
  
  for (int i = 0; i < list.size(); ++i) {
    QFileInfo fileInfo = list.at(i);
    QString str = fileInfo.fileName().leftJustified(len);
    str.append(QString("%1").arg(fileInfo.size()));
    out << str << endl;
  }

  return 0;
}
```
